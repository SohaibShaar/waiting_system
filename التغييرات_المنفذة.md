# التغييرات المُنفذة على النظام

## 📌 ملخص التغييرات

تم تنفيذ التعديلات التالية على نظام الانتظار:

### 1. إضافة حقل "اسم الأم"
- ✅ تمت إضافة حقل "اسم الأم" للزوج
- ✅ تمت إضافة حقل "اسم الأم" للزوجة
- ✅ الحقل إلزامي عند إدخال البيانات
- ✅ **ملاحظة:** اسم الأم لن يظهر في الإيصال المطبوع (حسب طلبك)

### 2. تعديل سلوك الحقول عند اختيار "خارج القطر" أو "خارج المحافظة"
تم تعديل النظام بحيث:
- ✅ عند اختيار "خارج القطر" → تظهر جميع الحقول ويمكن إدخال البيانات كاملة
- ✅ عند اختيار "خارج المحافظة" → تظهر جميع الحقول ويمكن إدخال البيانات كاملة
- ✅ البيانات لن تُمسح تلقائياً عند اختيار هذه الحالات

## 🎯 الحالات المتاحة

### للزوج:
1. **الزوج موجود** (الحالة العادية)
   - جميع الحقول ظاهرة ومطلوبة

2. **دعوة شرعية** للزوج
   - جميع الحقول ظاهرة ومطلوبة
   - يتم تلقائياً جعل حالة الزوجة "لا يوجد"

3. **خارج القطر** ✨ (تم التعديل)
   - جميع الحقول ظاهرة ومطلوبة
   - يمكن إدخال البيانات كاملة

4. **خارج المحافظة** ✨ (تم التعديل)
   - جميع الحقول ظاهرة ومطلوبة
   - يمكن إدخال البيانات كاملة

5. **لا يوجد زوج**
   - جميع الحقول مخفية
   - لا يمكن إدخال أي بيانات

### للزوجة:
نفس الحالات المذكورة أعلاه تنطبق على الزوجة أيضاً.

## 📝 الحقول المطلوبة

عند إدخال بيانات الزوج أو الزوجة (في أي حالة ما عدا "لا يوجد"):

### الحقول الإلزامية:
- الاسم الأول ⭐
- اسم الأب ⭐
- **اسم الأم** ⭐ (جديد)
- اسم العائلة ⭐
- تاريخ الميلاد ⭐
- الرقم الوطني ⭐
- العمر (يُحسب تلقائياً) ⭐

### الحقول الاختيارية:
- مكان الولادة
- البلد
- القيد

## 🔧 التعديلات الفنية

### 1. قاعدة البيانات
- تمت إضافة عمودين جديدين في جدول `reception_data`:
  - `maleMotherName` (اسم أم الزوج)
  - `femaleMotherName` (اسم أم الزوجة)

### 2. الواجهة الخلفية (Backend)
- تم تحديث جميع دوال الإدخال والتحديث لدعم الحقول الجديدة
- تم تحديث التحققات (Validations) لضمان إدخال اسم الأم

### 3. الواجهة الأمامية (Frontend)
- تمت إضافة حقول إدخال اسم الأم في نموذج الاستقبال
- تم تعديل منطق إظهار/إخفاء الحقول
- تم إزالة منطق مسح البيانات عند اختيار "خارج القطر" أو "خارج المحافظة"

## ⚠️ تعليمات مهمة

### لتشغيل النظام بعد التعديلات:

1. **أوقف Server الخلفي** (Backend) إذا كان قيد التشغيل
2. **شغّل الأمر التالي** في Terminal:
   ```bash
   npx prisma generate
   ```
3. **أعد تشغيل Server الخلفي**
4. **أعد تشغيل Frontend** إذا لزم الأمر

### للاختبار:

1. جرّب إضافة مراجع جديد بحالة "الزوج موجود"
   - تأكد من ظهور حقل "اسم الأم"
   - تأكد من أن الحقل إلزامي

2. جرّب إضافة مراجع بحالة "خارج القطر"
   - تأكد من ظهور جميع الحقول
   - تأكد من إمكانية إدخال البيانات كاملة

3. جرّب إضافة مراجع بحالة "خارج المحافظة"
   - تأكد من ظهور جميع الحقول
   - تأكد من إمكانية إدخال البيانات كاملة

4. جرّب تعديل بيانات مراجع موجود
   - تأكد من ظهور حقل اسم الأم
   - تأكد من حفظ البيانات بشكل صحيح

5. **تحقق من الإيصال المطبوع**
   - تأكد من أن اسم الأم **لا يظهر** في الإيصال

## 📁 الملفات المُعدلة

1. `prisma/schema.prisma` - تعديل Schema
2. `prisma/migrations/20251019000000_add_mother_name_fields/migration.sql` - Migration جديد
3. `src/services/reception.service.ts` - تحديث خدمات الاستقبال
4. `src/controllers/reception.controller.ts` - تحديث Controllers
5. `web/src/pages/ReceptionPage.tsx` - تحديث واجهة الاستقبال

## ✅ تم الانتهاء

جميع التعديلات المطلوبة تم تنفيذها بنجاح! 🎉

إذا واجهت أي مشكلة، يرجى التواصل.

