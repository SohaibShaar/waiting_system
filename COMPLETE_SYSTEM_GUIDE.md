# 🏥 دليل النظام الكامل - نظام إدارة الأدوار

## نظرة شاملة
نظام متكامل لإدارة أدوار الفحص الطبي قبل الزواج مع واجهات أمامية كاملة.

---

## 🎯 ما تم إنجازه

### ✅ Backend (الخادم الخلفي)
1. **APIs كاملة:**
   - الاستقبال (Reception) - إنشاء مريض ودور تلقائياً
   - المحاسبة (Accounting) - تسجيل المدفوعات
   - المختبر (Lab) - الفحوصات الأولية
   - الطبيب (Doctor) - الفحص النهائي
   
2. **الاستدعاء التلقائي:**
   - المحاسبة: حفظ → استدعاء التالي
   - المختبر: حفظ → استدعاء التالي
   - الطبيب: حفظ → استدعاء التالي

3. **WebSocket:**
   - إشعارات فورية للشاشة العامة
   - تحديثات مباشرة عند كل استدعاء

### ✅ Frontend (الواجهات الأمامية)
1. **📺 الشاشة العامة** - عرض مباشر للاستدعاءات
2. **📝 محطة الاستقبال** - إضافة مرضى جدد
3. **💰 محطة المحاسبة** - تسجيل المدفوعات
4. **🔬 محطة المختبر** - الفحوصات الأولية
5. **👩‍⚕️ محطة الطبيبة** - الفحص النهائي
6. **🏠 الصفحة الرئيسية** - روابط لجميع المحطات

---

## 🚀 التشغيل السريع

### الخطوة 1: تشغيل الخادم
```bash
# في المجلد الرئيسي
npm install
npm run dev
```
الخادم: `http://localhost:3001`

### الخطوة 2: تشغيل الواجهة
```bash
# في مجلد web
cd web
npm install
npm run dev
```
الواجهة: `http://localhost:5173`

### الخطوة 3: الوصول للنظام
- افتح `http://localhost:5173`
- اختر المحطة المطلوبة
- ابدأ العمل!

---

## 📋 سير العمل الكامل

### 1️⃣ الاستقبال (نقطة البداية)
```
موظف الاستقبال:
1. يفتح /reception
2. يدخل بيانات الزوجين
3. يضغط "حفظ"

النظام تلقائياً:
✅ ينشئ مريض جديد
✅ يقطع دور جديد
✅ يرسل للشاشة العامة
```

**API المستخدم:**
```bash
POST /api/reception
{
  "maleName": "أحمد",
  "maleLastName": "محمد",
  ...
}
```

**النتيجة:**
- مريض: أحمد محمد (1234567890)
- دور: #1
- ظهور على الشاشة

### 2️⃣ المحاسبة
```
موظف المحاسبة:
1. يفتح /accounting
2. يضغط "استدعاء التالي"
3. يظهر اسم الزوج والزوجة
4. يدخل المبلغ
5. يضغط ✅ "تم الدفع"
6. يضغط "حفظ"

النظام تلقائياً:
✅ يحفظ بيانات الدفع
✅ يستدعي المريض التالي
✅ يرسل للشاشة
```

**API المستخدم:**
```bash
POST /api/stations/2/call-next  # استدعاء
POST /api/accounting             # حفظ + استدعاء التالي
```

### 3️⃣ المختبر
```
فني المختبر:
1. يفتح /lab
2. يضغط "استدعاء التالي"
3. يختار: سليم ✅ أو غير سليم ❌
4. يضيف ملاحظات
5. يضغط "حفظ"

النظام تلقائياً:
✅ يحفظ نتائج الفحص
✅ يستدعي المريض التالي
✅ يرسل للشاشة
```

**API المستخدم:**
```bash
POST /api/stations/3/call-next  # استدعاء
POST /api/lab                    # حفظ + استدعاء التالي
```

### 4️⃣ الطبيبة (المحطة النهائية)
```
الطبيبة:
1. تفتح /doctor
2. تضغط "استدعاء التالي"
3. تدخل فصائل الدم
4. تدخل نتائج الفحوصات (HIV, HBS, HBC)
5. تكتب التقرير النهائي
6. تضغط "حفظ النهائي"

النظام تلقائياً:
✅ يحفظ جميع البيانات
✅ ينهي الدور
✅ يحفظ في الأرشيف
```

**API المستخدم:**
```bash
POST /api/stations/4/call-next  # استدعاء
POST /api/doctor                 # حفظ نهائي + إنهاء
```

---

## 🖥️ تفاصيل الواجهات

### الشاشة العامة 📺
**URL:** `/display`

**الميزات:**
- عرض رقم الدور بخط كبير
- رقم الشاشة بلون مميز
- قائمة بآخر 10 استدعاءات
- تحديث فوري عبر WebSocket
- تأثيرات بصرية جذابة

**الاستخدام:**
- ضعها على شاشة كبيرة
- وضع ملء الشاشة (F11)
- تعمل تلقائياً بدون تدخل

### محطة الاستقبال 📝
**URL:** `/reception`

**الحقول:**
- **الزوج:** الاسم، اسم العائلة، اسم الأب، تاريخ الميلاد، الرقم الوطني، العمر
- **الزوجة:** نفس الحقول
- **إضافي:** رقم الهاتف، الملاحظات، الأولوية

**العملية:**
1. املأ جميع الحقول
2. اضغط "حفظ وإنشاء دور جديد"
3. سيتم إنشاء مريض ودور تلقائياً

### محطة المحاسبة 💰
**URL:** `/accounting`

**العملية:**
1. اضغط "استدعاء التالي"
2. سيظهر:
   - رقم الدور
   - اسم الزوج
   - اسم الزوجة
3. أدخل المبلغ
4. ضع علامة ✅ "تم الدفع"
5. اضغط "حفظ وإنهاء"

### محطة المختبر 🔬
**URL:** `/lab`

**العملية:**
1. اضغط "استدعاء التالي"
2. للزوج:
   - اختر: ✅ سليم أو ❌ غير سليم
   - أضف ملاحظات
3. للزوجة:
   - نفس الخطوات
4. اضغط "حفظ واستدعاء التالي"

### محطة الطبيبة 👩‍⚕️
**URL:** `/doctor`

**العملية:**
1. اضغط "استدعاء التالي"
2. للزوج:
   - فصيلة الدم
   - نتيجة HIV (سلبي/إيجابي)
   - نتيجة HBS (سلبي/إيجابي)
   - نتيجة HBC (سلبي/إيجابي)
   - ملاحظات
3. للزوجة:
   - نفس الخطوات
4. التقرير النهائي
5. اضغط "حفظ النهائي وإنهاء الدور"

---

## 📊 قاعدة البيانات

### الجداول الرئيسية
- `Patient` - بيانات المرضى
- `Queue` - الأدوار النشطة
- `QueueHistory` - سجل الحركة
- `Station` - المحطات
- `ReceptionData` - بيانات الاستقبال
- `AccountingData` - بيانات المحاسبة
- `LabData` - بيانات المختبر
- `DoctorData` - بيانات الطبيب
- `CompletedVisit` - الزيارات المكتملة

---

## 🔌 الـ APIs

### الاستقبال
```
POST   /api/reception       # إنشاء مريض ودور جديد
GET    /api/reception/:id   # عرض البيانات
PUT    /api/reception/:id   # تحديث البيانات
```

### المحاسبة
```
POST   /api/accounting       # حفظ الدفع + استدعاء التالي
GET    /api/accounting/:id   # عرض البيانات
PUT    /api/accounting/:id   # تحديث البيانات
```

### المختبر
```
POST   /api/lab       # حفظ الفحص + استدعاء التالي
GET    /api/lab/:id   # عرض البيانات
PUT    /api/lab/:id   # تحديث البيانات
```

### الطبيب
```
POST   /api/doctor       # حفظ نهائي + إنهاء الدور
GET    /api/doctor/:id   # عرض البيانات
PUT    /api/doctor/:id   # تحديث البيانات
```

### المحطات
```
POST   /api/stations/:id/call-next         # استدعاء التالي
POST   /api/stations/:id/complete-service  # إنهاء الخدمة
GET    /api/stations/:id/waiting-list      # قائمة الانتظار
GET    /api/stations/:id/current           # المريض الحالي
```

---

## 🎨 التصميم

### Tailwind CSS Classes
```css
btn-primary     # أزرق - الحفظ
btn-success     # أخضر - النجاح
btn-secondary   # رمادي - الإلغاء
btn-danger      # أحمر - الحذف
input-field     # حقول الإدخال
card            # البطاقات
```

### الألوان
- 🔵 أزرق - الزوج
- 🌸 وردي - الزوجة
- 🟢 أخضر - سليم/نجاح
- 🔴 أحمر - غير سليم/خطأ
- 🟣 بنفسجي - الشاشة العامة

---

## 📦 الملفات المهمة

### Backend
```
src/
├── controllers/
│   ├── reception.controller.ts
│   ├── accounting.controller.ts
│   ├── lab.controller.ts
│   └── doctor.controller.ts
├── services/
│   ├── reception.service.ts
│   ├── accounting.service.ts
│   ├── lab.service.ts
│   └── doctor.service.ts
└── routes/
    ├── reception.routes.ts
    ├── accounting.routes.ts
    ├── lab.routes.ts
    └── doctor.routes.ts
```

### Frontend
```
web/src/
├── pages/
│   ├── DisplayScreen.tsx
│   ├── ReceptionPage.tsx
│   ├── AccountingPage.tsx
│   ├── LabPage.tsx
│   └── DoctorPage.tsx
├── App.tsx
└── index.css
```

---

## 📝 أمثلة عملية

### مثال 1: إضافة مريض جديد
```bash
# 1. افتح محطة الاستقبال
http://localhost:5173/reception

# 2. املأ البيانات
الزوج: أحمد محمد علي
الزوجة: فاطمة حسن خالد

# 3. اضغط حفظ
→ ينشأ دور #1 تلقائياً
→ يظهر على الشاشة
```

### مثال 2: معالجة في المحاسبة
```bash
# 1. افتح المحاسبة
http://localhost:5173/accounting

# 2. استدعاء
→ يظهر: دور #1 - أحمد محمد + فاطمة حسن

# 3. أدخل المبلغ: 500
# 4. ✅ تم الدفع
# 5. حفظ
→ يحفظ ويستدعي دور #2
```

### مثال 3: فحص في المختبر
```bash
# 1. افتح المختبر
http://localhost:5173/lab

# 2. استدعاء دور #1
# 3. الزوج: ✅ سليم
# 4. الزوجة: ✅ سليمة
# 5. حفظ
→ يحفظ ويستدعي دور #2
```

---

## 🔒 الأمان

- ✅ التحقق من البيانات في Backend
- ✅ التحقق من البيانات في Frontend
- ✅ معالجة الأخطاء
- ⚠️ يُنصح بإضافة المصادقة (Authentication)

---

## 📈 الإحصائيات

```
GET /api/stats/today      # إحصائيات اليوم
GET /api/stats/stations   # إحصائيات المحطات
GET /api/stats/custom     # إحصائيات مخصصة
```

---

## 🐛 استكشاف الأخطاء

### المشكلة: الخادم لا يعمل
```bash
# تحقق من المنفذ
netstat -ano | findstr :3001

# أعد تشغيل الخادم
npm run dev
```

### المشكلة: الواجهة لا تتصل
```typescript
// تحقق من API_URL في كل صفحة
const API_URL = 'http://localhost:3001/api';
```

### المشكلة: WebSocket لا يعمل
```typescript
// تحقق من اتصال Socket.IO
const socket = io('http://localhost:3001');
```

---

## 📚 التوثيق الإضافي

- `RECEPTION_AS_START_POINT.md` - شرح نظام الاستقبال
- `API_USAGE_GUIDE.md` - دليل استخدام APIs
- `FRONTEND_GUIDE.md` - دليل الواجهات الأمامية
- `API_EXAMPLES_UPDATED.http` - أمثلة APIs

---

## ✅ قائمة التحقق

### التثبيت
- [ ] Node.js مثبت
- [ ] MySQL قيد التشغيل
- [ ] `npm install` في المجلد الرئيسي
- [ ] `npm install` في مجلد web
- [ ] Migrations تم تشغيلها

### التشغيل
- [ ] الخادم يعمل على 3001
- [ ] الواجهة تعمل على 5173
- [ ] WebSocket متصل
- [ ] المحطات موجودة في قاعدة البيانات

### الاختبار
- [ ] إضافة مريض من الاستقبال
- [ ] ظهور على الشاشة
- [ ] استدعاء في المحاسبة
- [ ] فحص في المختبر
- [ ] فحص نهائي عند الطبيبة

---

## 🎉 جاهز للعمل!

النظام الآن جاهز بالكامل مع:
- ✅ Backend كامل
- ✅ Frontend كامل
- ✅ WebSocket للتحديثات الفورية
- ✅ Tailwind CSS للتصميم
- ✅ TypeScript للأمان
- ✅ APIs موثقة
- ✅ استدعاء تلقائي

**استمتع بالاستخدام! 🚀**

---

**تاريخ الإكمال:** 2025-10-12  
**الإصدار:** 2.1.0  
**حالة المشروع:** ✅ مكتمل وجاهز للإنتاج

