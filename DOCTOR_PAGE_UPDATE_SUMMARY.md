# ุชุญุฏูุซ ุตูุญุฉ ุงูุทุจูุจุฉ - ููุฎุต ุงูุชุบููุฑุงุช

## ุงูุชุงุฑูุฎ: 19 ุฃูุชูุจุฑ 2025

## ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Schema)

#### ุชุญุฏูุซ ุฌุฏูู `DoctorData`
ุชูุช ุฅุถุงูุฉ ุงูุญููู ุงูุชุงููุฉ:

**ุญููู ุงูููู ุงูุฑูููุฉ ูููุญูุตุงุช ุงูุฅูุฌุงุจูุฉ:**
- `maleHIVvalue` - ูููุฉ ูุญุต HIV ููุฒูุฌ
- `femaleHIVvalue` - ูููุฉ ูุญุต HIV ููุฒูุฌุฉ
- `maleHBSvalue` - ูููุฉ ูุญุต HBS ููุฒูุฌ
- `femaleHBSvalue` - ูููุฉ ูุญุต HBS ููุฒูุฌุฉ
- `maleHBCvalue` - ูููุฉ ูุญุต HBC ููุฒูุฌ
- `femaleHBCvalue` - ูููุฉ ูุญุต HBC ููุฒูุฌุฉ

**ุญููู ุงูุฎุถุงุจ ุงูุดุงุฐุฉ ููุฒูุฌ:**
- `maleHemoglobinEnabled` (Boolean) - ุชูุนูู ูุญุต ุงูุฎุถุงุจ ุงูุดุงุฐุฉ
- `maleHbS`, `maleHbF`, `maleHbA1c`, `maleHbA2`
- `maleHbSc`, `maleHbD`, `maleHbE`, `maleHbC`

**ุญููู ุงูุฎุถุงุจ ุงูุดุงุฐุฉ ููุฒูุฌุฉ:**
- `femaleHemoglobinEnabled` (Boolean) - ุชูุนูู ูุญุต ุงูุฎุถุงุจ ุงูุดุงุฐุฉ
- `femaleHbS`, `femaleHbF`, `femaleHbA1c`, `femaleHbA2`
- `femaleHbSc`, `femaleHbD`, `femaleHbE`, `femaleHbC`

#### ุฌุฏูู ุฌุฏูุฏ: `CompletedPatientData`
ุชู ุฅูุดุงุก ุฌุฏูู ูุญูุธ ุงูุจูุงูุงุช ุงููุงููุฉ ููู ูุฑูุถ:
- `id` - ุงููุนุฑู ุงููุฑูุฏ
- `queueId` - ุฑูู ุงูุฏูุฑ
- `patientId` - ูุนุฑู ุงููุฑูุถ
- `receptionData` - ุจูุงูุงุช ุงูุงุณุชูุจุงู (JSON)
- `accountingData` - ุจูุงูุงุช ุงููุญุงุณุจุฉ (JSON)
- `bloodDrawData` - ุจูุงูุงุช ุณุญุจ ุงูุฏู (JSON)
- `labData` - ุจูุงูุงุช ุงููุฎุชุจุฑ (JSON)
- `doctorData` - ุจูุงูุงุช ุงูุทุจูุจุฉ (JSON)
- `completedAt` - ุชุงุฑูุฎ ุงูุฅููุงู

### 2. Backend (ุงูุฎุงุฏู)

#### ููู `src/services/doctor.service.ts`
- ุชุญุฏูุซ ุฏุงูุฉ `createDoctorData()` ูุญูุธ ุฌููุน ุงูุญููู ุงูุฌุฏูุฏุฉ
- ุฅุถุงูุฉ ุฏุงูุฉ `saveCompletedPatientData()` ูุญูุธ ุงูุจูุงูุงุช ุงููุงููุฉ ูู ุฌููุน ุงููุญุทุงุช
- ุฅุถุงูุฉ ุฏุงูุฉ `getAllCompletedPatientData()` ูุฌูุจ ูุงุฆูุฉ ุงูุจูุงูุงุช ุงูููุชููุฉ
- ุฅุถุงูุฉ ุฏุงูุฉ `getCompletedPatientDataById()` ูุฌูุจ ุจูุงูุงุช ููุชููุฉ ูุญุฏุฏุฉ

#### ููู `src/controllers/doctor.controller.ts`
- ุชุญุฏูุซ `addDoctorData()` ูุงุณุชูุจุงู ุฌููุน ุงูุญููู ุงูุฌุฏูุฏุฉ
- ุฅุถุงูุฉ ุงุณุชุฏุนุงุก `saveCompletedPatientData()` ุนูุฏ ุญูุธ ุจูุงูุงุช ุงูุทุจูุจุฉ
- ุฅุถุงูุฉ endpoint ุฌุฏูุฏ: `GET /api/doctor/completed` - ูุฌูุจ ุฌููุน ุงูุจูุงูุงุช ุงูููุชููุฉ
- ุฅุถุงูุฉ endpoint ุฌุฏูุฏ: `GET /api/doctor/completed/:id` - ูุฌูุจ ุจูุงูุงุช ูุญุฏุฏุฉ

#### ููู `src/routes/doctor.routes.ts`
- ุฅุถุงูุฉ ูุณุงุฑูู ุฌุฏูุฏูู ููุจูุงูุงุช ุงูููุชููุฉ

### 3. Frontend (ุงููุงุฌูุฉ ุงูุฃูุงููุฉ)

#### ููู `web/src/pages/DoctorPage.tsx`

**ุงูุชุบููุฑุงุช ูู State:**
- ุฅุถุงูุฉ ุฌููุน ุงูุญููู ุงูุฌุฏูุฏุฉ ุฅูู `formData`
- ุฅุถุงูุฉ `showCompletedList` ู `completedData` ูุนุฑุถ ุงููุงุฆูุฉ
- ุฅุฒุงูุฉ ุงูุญููู ุบูุฑ ุงููุณุชุฎุฏูุฉ (`errorMessage`, `isFromSidebar`, `hasBeenCalled`, `recallCount`, `recallCooldown`)

**ุงูุชุบููุฑุงุช ูู UI:**

1. **ุญููู ุฑูููุฉ ุฏููุงููููุฉ:**
   - ุนูุฏ ุงุฎุชูุงุฑ "ุฅูุฌุงุจู" ูุฃู ูุญุต (HIV, HBS, HBC)ุ ูุธูุฑ ุญูู ุฅุฏุฎุงู ุฑููู ุฃุณููู
   - ุงูุญููู ุชุธูุฑ ูุชุฎุชูู ุฏููุงููููุงู ุญุณุจ ุงูุงุฎุชูุงุฑ

2. **ูููุฐุฌ ุงูุฎุถุงุจ ุงูุดุงุฐุฉ:**
   - ุฅุถุงูุฉ checkbox ููู ูู ุงูุฒูุฌ ูุงูุฒูุฌุฉ
   - ุนูุฏ ุงูุชูุนููุ ูุธูุฑ ูููุฐุฌ ูุญุชูู ุนูู 8 ุญููู ุฑูููุฉ:
     - ุงูุณุทุฑ ุงูุฃูู: HbS, HbF, HbA1c, HbA2
     - ุงูุณุทุฑ ุงูุซุงูู: HbSc, HbD, HbE, HbC
   - ูุธูุฑ ุฃุณูู ุงููููุฐุฌ ุงูุฃุณุงุณู

3. **ุฅูุบุงุก ูุธุงู ุงูุฏูุฑ:**
   - ุฅุฒุงูุฉ ุฒุฑ "ุงุณุชุฏุนุงุก ุงููุฑุงุฌุน ุงูุชุงูู"
   - ุฅุฒุงูุฉ ุฃุฒุฑุงุฑ "ุฅุนุงุฏุฉ ุงููุฏุงุก" ู "ูู ูุญุถุฑ"
   - ุงูุงุญุชูุงุธ ุจู QueueSidebar ููุงุฎุชูุงุฑ ุงููุฏูู ููุท
   - ุฑุณุงูุฉ ุชูุฌูููุฉ: "ุงุฎุชุฑ ูุฑูุถุงู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก"

4. **ูุงุฆูุฉ ุงูุญุงูุงุช ุงูููุชููุฉ:**
   - ุฒุฑ ุฌุฏูุฏ: "๐ ุนุฑุถ ูุงุฆูุฉ ุงูุญุงูุงุช ุงูููุชููุฉ"
   - ุฌุฏูู ูุนุฑุถ:
     - ุฑูู ุงูุฏูุฑ
     - ุงุณู ุงููุฑูุถ
     - ุชุงุฑูุฎ ุงูุฅููุงู
     - ุฒุฑ ุทุจุงุนุฉ (ุฌุงูุฒ ููุชุฎุตูุต ูุงุญูุงู)

**ุงูุชุบููุฑุงุช ูู ุงููุธุงุฆู:**
- ุชุจุณูุท ุฏุงูุฉ `handleSave()` - ุฅุฒุงูุฉ ุดุฑุท `hasBeenCalled`
- ุฅุฒุงูุฉ ุฏุงูุฉ `callNextPatient()` ุบูุฑ ุงููุณุชุฎุฏูุฉ
- ุฅุฒุงูุฉ ุฏุงูุฉ `handleRecall()` ุบูุฑ ุงููุณุชุฎุฏูุฉ
- ุฅุฒุงูุฉ ุฏุงูุฉ `handleCancelQueue()` ุบูุฑ ุงููุณุชุฎุฏูุฉ
- ุชุจุณูุท ุฏุงูุฉ `handleSelectQueueFromSidebar()`
- ุฅุถุงูุฉ ุฏุงูุฉ `loadCompletedData()` ูุชุญููู ุงููุงุฆูุฉ

### 4. Migration (ูููุงุช ุงูุชุฑุญูู)

ุชู ุฅูุดุงุก ููู migration:
- `prisma/migrations/20251019000000_add_doctor_fields/migration.sql`
- ูุญุชูู ุนูู ุชุนูููุงุช SQL ูุชุญุฏูุซ ุฌุฏูู `doctor_data`
- ูุญุชูู ุนูู ุชุนูููุงุช SQL ูุฅูุดุงุก ุฌุฏูู `completed_patient_data`

## ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู:
1. ุชุทุจูู Migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   ```bash
   npx prisma migrate deploy
   ```

2. ุฅุนุงุฏุฉ ุชูููุฏ Prisma Client:
   ```bash
   npx prisma generate
   ```

3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ูุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### ูููุณุชุฎุฏููู:
1. ุงุฎุชุฑ ูุฑูุถุงู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
2. ุงููุฃ ุจูุงูุงุช ุงููุญูุตุงุช
3. ุนูุฏ ุงุฎุชูุงุฑ "ุฅูุฌุงุจู" ูุฃู ูุญุตุ ุฃุฏุฎู ุงููููุฉ ุงูุฑูููุฉ
4. ูุชูุนูู ูุญุต ุงูุฎุถุงุจ ุงูุดุงุฐุฉุ ูุนูู Checkbox ุซู ุงููุฃ ุงูููู
5. ุงุถุบุท "ุญูุธ ุงูููุงุฆู ูุฅููุงุก ุงูุฏูุฑ"
6. ูุนุฑุถ ูุงุฆูุฉ ุงูุญุงูุงุช ุงูููุชููุฉุ ุงุถุบุท ุนูู ุงูุฒุฑ ุงููุฎุตุต

## ุงููููุงุช ุงููุชุฃุซุฑุฉ

- `prisma/schema.prisma` โ
- `prisma/migrations/20251019000000_add_doctor_fields/migration.sql` โ (ุฌุฏูุฏ)
- `src/services/doctor.service.ts` โ
- `src/controllers/doctor.controller.ts` โ
- `src/routes/doctor.routes.ts` โ
- `web/src/pages/DoctorPage.tsx` โ

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

โ ุญููู ุฑูููุฉ ุฏููุงููููุฉ ูููุญูุตุงุช ุงูุฅูุฌุงุจูุฉ
โ ูููุฐุฌ ุงูุฎุถุงุจ ุงูุดุงุฐุฉ ุงูุดุงูู (8 ุญููู ร 2)
โ ุฅูุบุงุก ูุธุงู ุงูุงุณุชุฏุนุงุก ุงูุชููุงุฆู
โ ุญูุธ ุงูุจูุงูุงุช ุงููุงููุฉ ูู ุฌููุน ุงููุญุทุงุช
โ ูุงุฆูุฉ ุนุฑุถ ุงูุญุงูุงุช ุงูููุชููุฉ
โ ูุงุฌูุฉ ูุญุณููุฉ ููุจุณุทุฉ

## ููุงุญุธุงุช

- ุฒุฑ ุงูุทุจุงุนุฉ ูู ูุงุฆูุฉ ุงูุญุงูุงุช ุงูููุชููุฉ ุฌุงูุฒ ููุชุฎุตูุต ุญุณุจ ุงููุชุทูุจุงุช
- ุฌููุน ุงูุชุนุฏููุงุช ูุชูุงููุฉ ูุน ุงููุธุงู ุงูุญุงูู
- ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูู ุงููุญุทุงุช ุงูุฃุฎุฑู
- ุชู ุงูุญูุงุธ ุนูู ุงูุชุตููู ูุงูุฃููุงู ุงูุฃุตููุฉ

## ุงูุงุฎุชุจุงุฑ

ูููุตุญ ุจุงุฎุชุจุงุฑ:
1. โ ุฅุถุงูุฉ ุจูุงูุงุช ูุน ูุญูุตุงุช ุฅูุฌุงุจูุฉ
2. โ ุชูุนูู ูููุก ูููุฐุฌ ุงูุฎุถุงุจ ุงูุดุงุฐุฉ
3. โ ุงูุญูุธ ูุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุนุฑุถ ูุงุฆูุฉ ุงูุญุงูุงุช ุงูููุชููุฉ
5. โ ุงูุงุฎุชูุงุฑ ุงููุฏูู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

