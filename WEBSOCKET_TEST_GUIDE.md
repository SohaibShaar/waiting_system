# ุฏููู ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุญุฏูุซ ุงูููุฑู (WebSocket)

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุชุทุจูู ูุธุงู WebSocket ููุชุญุฏูุซ ุงูููุฑู ูู ุฌููุน ุงูุตูุญุงุช:

### 1. Backend (Node.js/Express)

#### ููู `src/index.ts`
- โ `emitNewQueue()` - ุฅุฑุณุงู ุฅุดุนุงุฑ ุนูุฏ ุฅูุดุงุก ุฏูุฑ ุฌุฏูุฏ
- โ `emitQueueUpdate()` - ุฅุฑุณุงู ุฅุดุนุงุฑ ุนูุฏ ุชุญุฏูุซ ุงูุฏูุฑ
- โ `emitQueueCompleted()` - ุฅุฑุณุงู ุฅุดุนุงุฑ ุนูุฏ ุฅููุงู ุงูุฏูุฑ
- โ `emitPatientCalled()` - ุฅุฑุณุงู ุฅุดุนุงุฑ ุนูุฏ ุงุณุชุฏุนุงุก ูุฑูุถ
- โ `emitScreenDataUpdate()` - ุชุญุฏูุซ ุงูุดุงุดุฉ ุงูุนุงูุฉ

#### ุงูู Controllers ุงููุญุฏุซุฉ:
- โ `reception.controller.ts` - ูุฑุณู `new-queue` ู `queue-updated` ุนูุฏ ุฅุถุงูุฉ ูุฑูุถ
- โ `accounting.controller.ts` - ูุฑุณู `queue-updated` ุนูุฏ ุญูุธ ุจูุงูุงุช ุงููุญุงุณุจุฉ
- โ `lab.controller.ts` - ูุฑุณู `queue-updated` ุนูุฏ ุญูุธ ุจูุงูุงุช ุงููุฎุชุจุฑ
- โ `doctor.controller.ts` - ูุฑุณู `queue-updated` ู `queue-completed` ุนูุฏ ุฅููุงู ุงููุญุต
- โ `station.controller.ts` - ูุฑุณู ุชุญุฏูุซุงุช ุนูุฏ ุงุณุชุฏุนุงุก ูุฅููุงู ุงูุฎุฏูุฉ

### 2. Frontend (React)

#### Hook ุงููุฎุตุต: `web/src/hooks/useQueueUpdates.ts`
```typescript
// ูุณุชูุน ููุฃุญุฏุงุซ ุงูุชุงููุฉ:
- new-queue          // ุฏูุฑ ุฌุฏูุฏ ุชู ุฅูุดุงุคู
- queue-updated      // ุชุญุฏูุซ ูู ุญุงูุฉ ุงูุฏูุฑ
- patient-called     // ุชู ุงุณุชุฏุนุงุก ูุฑูุถ
- queue-completed    // ุงูุชูู ุงูุฏูุฑ
```

#### Component ุงููุดุชุฑู: `web/src/components/QueueSidebar.tsx`
- ูุนุฑุถ ูุงุฆูุฉ ุงูุฃุฏูุงุฑ ุงููุดุทุฉ
- ูุชู ุชุตููุฉ ุงููุงุฆูุฉ ุญุณุจ ุงููุญุทุฉ
- ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุฃู ุญุฏุซ WebSocket

#### ุงูุตูุญุงุช ุงููุญุฏุซุฉ:
- โ `ReceptionPage.tsx` - ุชุธูุฑ ูุงุฆูุฉ ุงููุฑุถู ุงูููู + sidebar
- โ `AccountingPage.tsx` - sidebar ูุนุฑุถ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
- โ `LabPage.tsx` - sidebar ูุนุฑุถ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
- โ `DoctorPage.tsx` - sidebar ูุนุฑุถ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุชุดุบูู Backend
```bash
cd C:\Users\SSH\Desktop\node.js\final_waiting_system
npm run dev
```

### ุงูุฎุทูุฉ 2: ุชุดุบูู Frontend
```bash
cd C:\Users\SSH\Desktop\node.js\final_waiting_system\web
npm run dev
```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงูููุฑู

1. **ุงูุชุญ ุตูุญุฉ ุงููุญุงุณุจุฉ** ูู ุงููุชุตูุญ ุงูุฃูู
2. **ุงูุชุญ ุตูุญุฉ ุงูุงุณุชูุจุงู** ูู ูุชุตูุญ ุขุฎุฑ (ุฃู ูุงูุฐุฉ ุฃุฎุฑู)
3. **ุฃุถู ูุฑูุถ ุฌุฏูุฏ** ูู ุตูุญุฉ ุงูุงุณุชูุจุงู
4. **ุฑุงูุจ ุตูุญุฉ ุงููุญุงุณุจุฉ** - ูุฌุจ ุฃู ูุธูุฑ ุงููุฑูุถ ููุฑุงู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

### ุงูุฎุทูุฉ 4: ุชุชุจุน ุงูุฃุญุฏุงุซ ูู Console

#### ูู Backend (Terminal):
```
โ Client connected: SOCKET_ID
๐ก Emitted new-queue to all clients: { queueId, queueNumber, patient }
๐ก Emitted queue-updated to all clients
```

#### ูู Frontend (Browser Console):
```
โ WebSocket ูุชุตู
๐ ุฏูุฑ ุฌุฏูุฏ: { queueId, queueNumber, patient }
๐ ุชุญุฏูุซ ุงูุฏูุฑ: { ... }
```

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงููุงุฆูุฉ ูุง ุชุชุญุฏุซ

#### ุงูุญู 1: ุชุฃูุฏ ูู ุชุดุบูู Backend
```bash
# ุชุญูู ูู ุฃู ุงูุฎุงุฏู ูุนูู ุนูู ุงููููุฐ 3003
curl http://localhost:3003
```

#### ุงูุญู 2: ุชุญูู ูู WebSocket Connection
ุงูุชุญ Browser Console ูุงูุชุจ:
```javascript
// ูุฌุจ ุฃู ุชุฑู "โ WebSocket ูุชุตู"
```

#### ุงูุญู 3: ุชุญูู ูู ุงูุฃุญุฏุงุซ
ูู Backend terminalุ ูุฌุจ ุฃู ุชุฑู:
```
๐ก Emitted new-queue to all clients
```

ุฅุฐุง ูู ุชุฑู ูุฐู ุงูุฑุณุงูุฉุ ุชุญูู ูู:
- ูู ุชู ุญูุธ ุงููููุงุช ุงููุญุฏุซุฉุ
- ูู ุชู ุฅุนุงุฏุฉ ุชุดุบูู Backend ุจุนุฏ ุงูุชุญุฏูุซุงุชุ

### ุงููุดููุฉ: WebSocket ูุง ูุชุตู

#### ุงูุณุจุจ ุงููุญุชูู:
- Backend ุบูุฑ ููุฏ ุงูุชุดุบูู
- Frontend ูุญุงูู ุงูุงุชุตุงู ุจุนููุงู ุฎุงุทุฆ

#### ุงูุญู:
ุชุญูู ูู `web/src/hooks/useQueueUpdates.ts`:
```typescript
const newSocket = io("http://localhost:3003"); // ุชุฃูุฏ ูู ุงูุนููุงู
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญุฏูุซ ุงูููุฑู** ูุนูู ููุท ุนูุฏูุง ูููู Backend ู Frontend ูุนููุงู ูุนุงู
2. **ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ** ุชุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ:
   - ุฅุถุงูุฉ ูุฑูุถ ุฌุฏูุฏ
   - ุงุณุชุฏุนุงุก ูุฑูุถ
   - ุฅููุงู ุฎุฏูุฉ ูู ูุญุทุฉ
   - ุฅููุงู ุงูุฏูุฑ ุจุงููุงูู
3. **ุงูุชุตููุฉ** ุชุญุฏุซ ูู `QueueSidebar` ุญุณุจ ุงููุญุทุฉ:
   - ุงููุญุงุณุจุฉ: ุฌููุน ุงูุฃุฏูุงุฑ ุงูุฌุฏูุฏุฉ
   - ุงููุฎุชุจุฑ: ุงูุฃุฏูุงุฑ ุงูุชู ูุฑุช ุจุงููุญุงุณุจุฉ
   - ุงูุทุจูุจุฉ: ุงูุฃุฏูุงุฑ ุงูุชู ูุฑุช ุจุงููุฎุชุจุฑ

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุฅุฐุง ูุงูุช ุงูููุงุฆู ูุง ุชุฒุงู ูุง ุชุชุญุฏุซ:
1. ุฃุนุฏ ุชุดุบูู Backend
2. ุฃุนุฏ ุชุดุบูู Frontend
3. ุงูุณุญ cache ุงููุชุตูุญ (Ctrl+Shift+R)
4. ุชุญูู ูู console ููุฃุฎุทุงุก

