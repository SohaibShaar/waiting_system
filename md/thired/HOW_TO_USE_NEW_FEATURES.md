# 📘 كيفية استخدام الميزات الجديدة

## التاريخ: 2025-10-12

---

## 🎯 الميزات الجديدة المتاحة في جميع المحطات

### المحطات المحدثة:
- ✅ المحاسبة (Accounting)
- ✅ المختبر (Lab)
- ✅ الطبيبة - الفحص النهائي (Doctor)

---

## 📋 الميزة 1: اختيار مريض من القائمة

### الطريقة:
1. انظر إلى **قائمة الانتظار** على الجانب الأيمن
2. **اضغط على أي بطاقة مريض** تريد التعامل معها
3. ستظهر بياناته تلقائياً في النموذج

### مثال:
```
📋 قائمة الانتظار
┌─────────────────────┐
│ #5 👨 أحمد محمد    │ ← اضغط هنا
│    👩 فاطمة علي    │
│ 📍 المحاسبة         │
│ 👆 اضغط للتفاصيل   │
└─────────────────────┘
```

### الفائدة:
- لا حاجة للانتظار حتى يأتي دوره بالترتيب
- يمكنك التعامل مع المريض مباشرة

---

## 🔔 الميزة 2: إعادة النداء (3 محاولات)

### متى تستخدمها؟
- عندما تختار مريض من القائمة ولم يحضر
- عندما تريد إعطاءه فرصة إضافية

### الطريقة:
1. بعد اختيار المريض من القائمة، ستظهر أزرار إضافية أسفل النموذج
2. اضغط على زر **🔔 إعادة النداء**
3. سيظهر العداد: `(1/3)` ← المحاولة الأولى
4. انتظر قليلاً للمريض
5. إذا لم يحضر، اضغط مرة أخرى: `(2/3)` ← المحاولة الثانية
6. انتظر قليلاً
7. إذا لم يحضر، اضغط مرة ثالثة: `(3/3)` ← المحاولة الثالثة

### مثال:
```
┌──────────────────────────────────┐
│  [ 🔔 إعادة النداء (1/3) ]      │ ← برتقالي
└──────────────────────────────────┘
```

### ماذا يحدث؟
- كل مرة تضغط فيها → يُرسل إشعار فوري لشاشة العرض
- يُعرض رقم الدور على الشاشة
- يُشغّل الصوت (إذا كان مفعّلاً)

---

## ❌ الميزة 3: لم يحضر (الإلغاء)

### متى تستخدمها؟
- عندما تستدعي المريض **3 مرات** ولم يحضر
- عندما تريد حذف دوره من النظام

### الطريقة:
1. بعد الضغط على **إعادة النداء 3 مرات**
2. سيصبح زر **❌ لم يحضر** مفعّلاً (أحمر)
3. اضغط عليه
4. سيظهر تأكيد: "هل أنت متأكد؟"
5. اضغط **OK** للتأكيد
6. الدور يُحذف من النظام
7. الصفحة تُحدّث تلقائياً

### حماية:
```
❌ زر رمادي (معطّل)    ← عندما recallCount < 3
✅ زر أحمر (مفعّل)      ← عندما recallCount >= 3
```

### تحذير:
- ⚠️ **لا يمكن الإلغاء** إلا بعد 3 محاولات نداء
- ⚠️ **الحذف نهائي** - لا يمكن التراجع
- ⚠️ **يُحذف الدور من النظام بالكامل**

---

## 🎬 مثال عملي كامل

### السيناريو: مريض في المحاسبة لم يحضر

#### الخطوة 1: اختيار المريض
```
📋 قائمة الانتظار
┌─────────────────────┐
│ #8 👨 خالد أحمد     │ ← اضغط هنا
│    👩 سارة محمود    │
└─────────────────────┘

↓ (بعد الضغط)

📝 بيانات المريض
┌─────────────────────┐
│ الدور: #8           │
│ الزوج: خالد أحمد    │
│ الزوجة: سارة محمود  │
│ المبلغ: _____ ريال  │
└─────────────────────┘
```

#### الخطوة 2: المريض لم يحضر → إعادة النداء
```
🔔 إعادة النداء (0/3)  ← اضغط
↓
🔔 إعادة النداء (1/3)  ← الآن 1/3، انتظر دقيقة
↓
🔔 إعادة النداء (1/3)  ← اضغط مرة ثانية
↓
🔔 إعادة النداء (2/3)  ← الآن 2/3، انتظر دقيقة
↓
🔔 إعادة النداء (2/3)  ← اضغط مرة ثالثة
↓
🔔 إعادة النداء (3/3)  ← الآن 3/3
```

#### الخطوة 3: زر "لم يحضر" يُفعّل
```
❌ لم يحضر  ← (رمادي - معطل)
↓ (بعد 3 محاولات)
❌ لم يحضر  ← (أحمر - مفعّل) ← اضغط
```

#### الخطوة 4: التأكيد
```
⚠️ هل أنت متأكد من إلغاء الدور #8؟
   (المريض لم يحضر بعد 3 محاولات)

   [ إلغاء ]    [ OK ] ← اضغط OK
```

#### الخطوة 5: النتيجة
```
✅ تم إلغاء الدور #8
🔄 جاري تحديث الصفحة...

↓ (بعد ثانية)

الصفحة تُحدّث → القائمة تُحدّث → الدور #8 لم يعد موجوداً ✅
```

---

## 🎨 الفرق بين الزرين

### زر إعادة النداء 🔔
- **اللون**: برتقالي
- **الحالة**: دائماً مفعّل
- **الوظيفة**: إرسال إشعار للشاشة
- **التكرار**: لا محدود (لكن العداد يصل لـ 3)
- **الحذف**: لا يحذف شيئاً

### زر لم يحضر ❌
- **اللون**: رمادي (معطل) أو أحمر (مفعّل)
- **الحالة**: يُفعّل فقط بعد 3 محاولات
- **الوظيفة**: حذف الدور من النظام
- **التكرار**: مرة واحدة فقط
- **الحذف**: يحذف نهائياً

---

## 🔄 تدفق العمل الموصى به

### للمرضى الذين حضروا:
```
1. اضغط "استدعاء التالي"
   أو
   اختر من القائمة
   ↓
2. املأ البيانات
   ↓
3. اضغط "حفظ"
   ↓
4. ✅ مكتمل
```

### للمرضى الذين لم يحضروا:
```
1. اختر من القائمة
   ↓
2. اضغط "🔔 إعادة النداء" (1/3)
   ↓ انتظر دقيقة
3. اضغط "🔔 إعادة النداء" (2/3)
   ↓ انتظر دقيقة
4. اضغط "🔔 إعادة النداء" (3/3)
   ↓
5. اضغط "❌ لم يحضر" (الآن أحمر)
   ↓
6. ✅ تم الإلغاء
```

---

## 📞 مشاكل شائعة وحلولها

### المشكلة 1: لا أرى أزرار "إعادة النداء" و"لم يحضر"
**الحل**: هذه الأزرار تظهر فقط عندما تختار مريض من القائمة، وليس عند استدعاء التالي.

### المشكلة 2: زر "لم يحضر" رمادي ولا يعمل
**الحل**: يجب أن تضغط على "إعادة النداء" 3 مرات أولاً.

### المشكلة 3: بعد الإلغاء، المريض ما زال في القائمة
**الحل**: انتظر ثانية، الصفحة ستُحدّث تلقائياً. إذا لم تُحدّث، حدّث الصفحة يدوياً (F5).

### المشكلة 4: الإشعار لا يظهر على شاشة العرض
**الحل**: تأكد من:
- شاشة العرض مفتوحة (http://localhost:5173/display)
- الصوت مفعّل في الشاشة
- Backend يعمل (npm run dev)

---

## ✨ نصائح للاستخدام الأمثل

1. **لا تسرع**: انتظر دقيقة بين كل محاولة نداء
2. **تأكد دائماً**: قبل الضغط على "لم يحضر"
3. **استخدم القائمة**: للوصول السريع لأي مريض
4. **اتبع العداد**: انتظر حتى يصل لـ 3/3 قبل الإلغاء

---

**🎉 استمتع بالميزات الجديدة! النظام الآن أكثر مرونة واحترافية! 🚀**

