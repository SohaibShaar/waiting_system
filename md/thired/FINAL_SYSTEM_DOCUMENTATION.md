# ๐ ุฏููู ุงููุธุงู ุงูููุงุฆู - ูุธุงู ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ

## ๐ฏ ููุฎุต ุงูุชุญุฏูุซุงุช ุงูููุงุฆูุฉ

ุชู ุชุทุจูู ูุธุงู ูุชูุงูู ููุชุญุฏูุซ ุงูููุฑู (Real-time) ุจุงุณุชุฎุฏุงู WebSocketุ ูุน ุนุฑุถ ููุงุฆู ุงูุชุธุงุฑ ูุฎุตุตุฉ ููู ูุญุทุฉ.

---

## ๐ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุงูุชุญุฏูุซ ุงูููุฑู (Real-time Updates)
- โ ุนูุฏ ุฅุถุงูุฉ ูุฑูุถ ุฌุฏูุฏ ูู **ุงูุงุณุชูุจุงู**ุ ูุธูุฑ ููุฑุงู ูู ูุงุฆูุฉ **ุงููุญุงุณุจุฉ**
- โ ุนูุฏ ุฅููุงุก ุงูุฎุฏูุฉ ูู ูุญุทุฉุ ููุชูู ุงููุฑูุถ ุชููุงุฆูุงู ูููุญุทุฉ ุงูุชุงููุฉ
- โ ุชุญุฏูุซ ููุฑู ูุฌููุน ุงูุตูุญุงุช ุงูููุชูุญุฉ ูู ููุณ ุงูููุช

### 2. ููุงุฆู ุงูุงูุชุธุงุฑ ุงููุฎุตุตุฉ
ูู ูุญุทุฉ ุชุนุฑุถ **ููุท** ุงูุฃุดุฎุงุต ุงูุฐูู ููุชุธุฑูู ุฏูุฑูู ูู ุชูู ุงููุญุทุฉ:

#### ๐ ุงููุญุงุณุจุฉ (Station #2)
- ูุธูุฑ ุงููุฑุถู ุงูุฐูู ุฃูููุง ุงูุงุณุชูุจุงู
- `currentStation.displayNumber === 2` ุฃู `currentStation.name === "ุงููุญุงุณุจุฉ"`

#### ๐ ุงููุฎุชุจุฑ (Station #3)
- ูุธูุฑ ุงููุฑุถู ุงูุฐูู ุฃูููุง ุงููุญุงุณุจุฉ
- `currentStation.displayNumber === 3` ุฃู `currentStation.name === "ุงููุฎุชุจุฑ"`

#### ๐ ุงูุทุจูุจุฉ (Station #4)
- ูุธูุฑ ุงููุฑุถู ุงูุฐูู ุฃูููุง ุงููุฎุชุจุฑ
- `currentStation.displayNumber === 4` ุฃู `currentStation.name === "ุงูุทุจูุจุฉ"`

---

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### Backend (Node.js)

#### 1. ููู `src/index.ts`
```typescript
// ูุธุงุฆู WebSocket ุงูุฌุฏูุฏุฉ
export const emitNewQueue = (data: any) => {
  io.emit("new-queue", data); // ุฅุฑุณุงู ูุฌููุน ุงูุนููุงุก
};

export const emitQueueUpdate = (data: any) => {
  io.emit("queue-updated", data);
};

export const emitQueueCompleted = (data: any) => {
  io.emit("queue-completed", data);
};
```

#### 2. ููู `src/controllers/reception.controller.ts`
```typescript
// ุนูุฏ ุฅุถุงูุฉ ูุฑูุถ ุฌุฏูุฏ
emitNewQueue({
  queueId: result.queue.id,
  queueNumber: result.queueNumber,
  patient: result.patient,
});

emitQueueUpdate({
  type: "NEW",
  queueId: result.queue.id,
  queueNumber: result.queueNumber,
});
```

#### 3. ููู `src/services/queue.service.ts`
```typescript
// ุชุถููู ุจูุงูุงุช ุงูุงุณุชูุจุงู ูู ุงูููุงุฆู
async function getAllActiveQueues() {
  return await prisma.queue.findMany({
    where: { status: OverallQueueStatus.ACTIVE },
    include: {
      patient: true,
      currentStation: true,
      ReceptionData: true, // โ ุฌุฏูุฏ
    },
    orderBy: { queueNumber: "asc" },
  });
}
```

#### 4. Controllers ุงูุฃุฎุฑู
- **accounting.controller.ts**: ูุฑุณู `queue-updated` ุนูุฏ ุญูุธ ุงูุจูุงูุงุช
- **lab.controller.ts**: ูุฑุณู `queue-updated` ุนูุฏ ุญูุธ ุงูุจูุงูุงุช
- **doctor.controller.ts**: ูุฑุณู `queue-updated` ู `queue-completed` ุนูุฏ ุงูุงูุชูุงุก

### Frontend (React)

#### 1. Hook ูุฎุตุต: `web/src/hooks/useQueueUpdates.ts`
```typescript
// ูุณุชูุน ููุฃุญุฏุงุซ:
- new-queue          // ุฏูุฑ ุฌุฏูุฏ
- queue-updated      // ุชุญุฏูุซ
- patient-called     // ุงุณุชุฏุนุงุก
- queue-completed    // ุงูุชูุงู
```

#### 2. Component: `web/src/components/QueueSidebar.tsx`
```typescript
const fetchQueues = async () => {
  const response = await axios.get(`${API_URL}/queue/active`);
  
  // ุชุตููุฉ ุญุณุจ ุงููุญุทุฉ ุงูุญุงููุฉ
  const filteredQueues = response.data.queues.filter((q) => {
    if (!q.currentStation) return false;
    
    if (stationName === "ุงููุญุงุณุจุฉ") {
      return q.currentStation.displayNumber === 2;
    } else if (stationName === "ุงููุฎุชุจุฑ") {
      return q.currentStation.displayNumber === 3;
    } else if (stationName === "ุงูุทุจูุจุฉ") {
      return q.currentStation.displayNumber === 4;
    }
    
    return false;
  });
  
  setQueues(filteredQueues);
};

// ุงูุชุญุฏูุซ ุนูุฏ WebSocket event
useEffect(() => {
  fetchQueues();
}, [stationName, updateTrigger]);
```

#### 3. ุงูุตูุญุงุช ุงููุญุฏุซุฉ
ุฌููุน ุงูุตูุญุงุช ุชุญุชูู ุนูู `<QueueSidebar>`:
- โ `ReceptionPage.tsx`
- โ `AccountingPage.tsx`
- โ `LabPage.tsx`
- โ `DoctorPage.tsx`

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงููุธุงู

#### Backend:
```bash
cd C:\Users\SSH\Desktop\node.js\final_waiting_system
npm run dev
```

#### Frontend:
```bash
cd web
npm run dev
```

### ุงูุฎุทูุฉ 2: ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ

1. **ุงูุชุญ 3 ููุงูุฐ ูุชุตูุญ:**
   - ูุงูุฐุฉ 1: ุตูุญุฉ ุงูุงุณุชูุจุงู `http://localhost:5173/reception`
   - ูุงูุฐุฉ 2: ุตูุญุฉ ุงููุญุงุณุจุฉ `http://localhost:5173/accounting`
   - ูุงูุฐุฉ 3: ุตูุญุฉ ุงููุฎุชุจุฑ `http://localhost:5173/lab`

2. **ุฃุถู ูุฑูุถ ุฌุฏูุฏ ูู ุตูุญุฉ ุงูุงุณุชูุจุงู:**
   - ุงููุฃ ุงูุจูุงูุงุช
   - ุงุถุบุท "ุฅุถุงูุฉ ูุฑูุถ"

3. **ุฑุงูุจ ุงูุชุญุฏูุซ ุงูููุฑู:**
   - โ ูุฌุจ ุฃู ูุธูุฑ ุงููุฑูุถ ููุฑุงู ูู ูุงุฆูุฉ ุงูุงุณุชูุจุงู
   - โ ูุฌุจ ุฃู ูุธูุฑ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงููุญุงุณุจุฉ (ุงููุงูุฐุฉ 2)
   - โ ูุง ูุธูุฑ ูู ุงููุฎุชุจุฑ (ูุฃูู ูู ููุฑ ุจุงููุญุงุณุจุฉ ุจุนุฏ)

4. **ุงูุชูู ูููุญุงุณุจุฉ:**
   - ุงุณุชุฏุนู ุงููุฑูุถ (`callNextPatient`)
   - ุฃุฏุฎู ุจูุงูุงุช ุงููุญุงุณุจุฉ
   - ุงุญูุธ ุงูุจูุงูุงุช

5. **ุฑุงูุจ ุงูุงูุชูุงู:**
   - โ ูุฎุชูู ูู ูุงุฆูุฉ ุงููุญุงุณุจุฉ
   - โ ูุธูุฑ ููุฑุงู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงููุฎุชุจุฑ (ุงููุงูุฐุฉ 3)

6. **ุฃููู ุจุงูู ุงููุญุทุงุช:**
   - ุงููุฎุชุจุฑ โ ุงูุทุจูุจุฉ
   - ูู ุงูุชูุงู ูุญุฏุซ ููุฑูุงู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูููุงุฆู ูุง ุชุชุญุฏุซ

#### ุงูุญู 1: ุชุญูู ูู WebSocket
ุงูุชุญ Browser Console (F12):
```javascript
// ูุฌุจ ุฃู ุชุฑู:
โ WebSocket ูุชุตู
๐ ุฌุงุฑู ุฌูุจ ุงูุฃุฏูุงุฑ ูู ุงููุญุงุณุจุฉ...
โ ุชู ุฌูุจ X ุฏูุฑ ูุดุท
๐ ุชู ุงูุนุซูุฑ ุนูู Y ุฏูุฑ ููุชุธุฑ ูู ุงููุญุงุณุจุฉ
```

#### ุงูุญู 2: ุชุญูู ูู Backend
ูู Terminal ุงูู Backend ูุฌุจ ุฃู ุชุฑู:
```
โ Client connected: SOCKET_ID
๐ก Emitted new-queue to all clients: { queueId, ... }
๐ก Emitted queue-updated to all clients
```

#### ุงูุญู 3: ุฃุนุฏ ุชุดุบูู ุงููุธุงู
```bash
# ุฃููู Backend (Ctrl+C)
# ุฃููู Frontend (Ctrl+C)

# ุฃุนุฏ ุงูุชุดุบูู
npm run dev  # ูู Backend
npm run dev  # ูู Frontend (ูุฌูุฏ web)
```

#### ุงูุญู 4: ุงูุณุญ Cache
ูู ุงููุชุตูุญ:
- ุงุถุบุท `Ctrl + Shift + R` (Hard Reload)
- ุฃู ุงูุชุญ DevTools โ Application โ Clear Storage โ Clear site data

---

## ๐ ุชุชุจุน ุงูุจูุงูุงุช

### Console Logs ูููุฏุฉ:

#### ูู Backend:
```
โ Client connected: abc123
๐ก Emitted new-queue to all clients: { queueId: 1, queueNumber: 101, ... }
๐ก Emitted queue-updated to all clients
```

#### ูู Frontend (Browser):
```
๐ ุฌุงุฑู ุฌูุจ ุงูุฃุฏูุงุฑ ูู ุงููุญุงุณุจุฉ...
โ ุชู ุฌูุจ 5 ุฏูุฑ ูุดุท
๐ ุชู ุงูุนุซูุฑ ุนูู 2 ุฏูุฑ ููุชุธุฑ ูู ุงููุญุงุณุจุฉ
๐ ุฏูุฑ ุฌุฏูุฏ: { queueId: 1, ... }
๐ ุชุญุฏูุซ ุงูุฏูุฑ: { ... }
```

---

## ๐จ ุงูุชุตููู

### ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ:
```css
--primary: #054239    /* ุงูุฃุฎุถุฑ ุงูุฏุงูู */
--secondary: #b9a779  /* ุงูุฐูุจู */
--dark: #3d3a3b       /* ุงูุฑูุงุฏู ุงูุฏุงูู */
--light: #edebe0      /* ุงูุจูุฌ ุงููุงุชุญ */
--white: #ffffff      /* ุงูุฃุจูุถ */
```

### ุงูููููุงุช:
- โ Header ููุญุฏ ูู ุฌููุน ุงูุตูุญุงุช
- โ QueueSidebar ุนูู ูุณุงุฑ ูู ุตูุญุฉ
- โ ุชุตููู responsive
- โ ุจุฏูู scroll (ูู ุดูุก ูู ุตูุญุฉ ูุงุญุฏุฉ)

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ููุงุฆู ุงูุงูุชุธุงุฑ ูุฎุตุตุฉ ููู ูุญุทุฉ**
   - ุงููุญุงุณุจุฉ ุชุฑู ููุท ูู ููุชุธุฑูุง
   - ุงููุฎุชุจุฑ ูุฑู ููุท ูู ููุชุธุฑู
   - ุงูุทุจูุจุฉ ุชุฑู ููุท ูู ููุชุธุฑูุง

2. **ุงูุชุญุฏูุซ ุงูููุฑู**
   - ูุนูู ููุท ุนูุฏูุง Backend ู Frontend ูุนููุงู ูุนุงู
   - ูุณุชุฎุฏู WebSocket (Socket.IO)
   - ูุง ูุญุชุงุฌ refresh ููุตูุญุฉ

3. **ุงูุชุฑุชูุจ**
   - ุงูููุงุฆู ูุฑุชุจุฉ ุญุณุจ ุฑูู ุงูุฏูุฑ (ูู ุงูุฃุตุบุฑ ููุฃูุจุฑ)
   - ุงูุฃููููุฉ (`priority`) ุชุธูุฑ ูู badge ุฃุญูุฑ

4. **ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ**
   - ุงุณู ุงูุฒูุฌ ูุงูุฒูุฌุฉ (ูู ReceptionData)
   - ุฑูู ุงูุฏูุฑ
   - ุญุงูุฉ ุงูุฏูุฑ (ูุดุทุ ููุชุธุฑุ ุฅูุฎ)
   - ุงููุญุทุฉ ุงูุญุงููุฉ

---

## ๐ ูุง ุงูุชุงููุ

ุงููุธุงู ุงูุขู ุฌุงูุฒ ุจุงููุงูู! ููููู:
1. ุงุฎุชุจุงุฑ ุงููุธุงู ุจุงูุณููุงุฑูู ุฃุนูุงู
2. ุฅุถุงูุฉ ูุฒูุฏ ูู ุงููุญุทุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑ
3. ุชุฎุตูุต ุงูุชุตููู ุญุณุจ ุงูุญุงุฌุฉ
4. ุฅุถุงูุฉ ูุฒูุฏ ูู ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู Console Logs (Backend & Frontend)
2. ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุฎุฏูุงุช ุชุนูู
3. ุฌุฑุจ Hard Reload ูููุชุตูุญ
4. ุฃุนุฏ ุชุดุบูู Backend

---

**ุชู ุจุญูุฏ ุงููู! โ**

ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ูุชูุงูู ูุน:
- โ ุชุญุฏูุซ ููุฑู ุนุจุฑ ุฌููุน ุงูุตูุญุงุช
- โ ููุงุฆู ุงูุชุธุงุฑ ูุฎุตุตุฉ ููู ูุญุทุฉ
- โ ุชุตููู ุฌููู ูุณูู ุงูุงุณุชุฎุฏุงู
- โ ุจุฏูู scroll ุฃู ูุดุงูู ูู ุงูุนุฑุถ

